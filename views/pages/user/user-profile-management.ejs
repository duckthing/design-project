<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Manage User Profile</title>
		<link rel="stylesheet" href="/css/example.css">
		<script src="/js/userprefs-manage-skills.js"></script>
	</head>
	<body>
		<nav id="main-nav">
				<div class="nav-header">
						<button class="nav-toggle" id="nav-toggle-btn">&#9776;</button>
				</div>
				<div class="nav-links" id="nav-links">
						<a class="nav-link" href="/">Home</a>
						<% if (session && session.isAuthenticated) { %>
								<a class="nav-link" href="../organizer/event-creation-page">Create Event</a>
								<a class="nav-link" href="/user/notifications">Notifications</a>
								<a class="nav-link" href="/organizer/volunteer-history">History</a>
								<a class="nav-link" href="/logout">Logout</a>
						<% } else { %>
								<a class="nav-link" href="/login">Log in</a>
						<% } %>
				</div>
		</nav>
		<div class="center">
			<article>
				<h1>Update your profile</h1>
				<!-- Personal info -->
				<div class="panelblock">
					<h2>Personal information</h2>
					<form method="post">
						<label for="fullName">Full name</label>
							<input type="text" id="fullName" name="fullName" maxlength="50" value="<%=profile.full_name%>" required>
							<br>
						<label for="address1">Address 1</label>
							<input type="text" id="address1" name="address1" maxlength="100" value="<%=profile.address1%>" required>
							<br>
						<label for="address2">Address 2</label>
							<input type="text" id="address2" name="address2" maxlength="100" value="<%=profile.address2%>">
							<br>
						<label for="city">City</label>
							<input type="text" id="city" name="city" maxlength="100" value="<%=profile.city%>" required>
							<br>
						<label for="state">State</label>
							<select id="state" name="state">
								<% for (const state of allStates) { %>
									<% const currStateCode = state.state_code; %>
									<% const currStateName = state.state_name; %>
									<% if (currStateCode == profile.state) { %>
										<option selected value=<%= currStateCode %>><%= currStateName %></option>
									<% } else { %>
										<option value=<%= currStateCode %>><%= currStateName %></option>
									<% } %>
								<% } %>
								
							</select>
							<br>
						<label for="zipcode">Zip Code</label>
							<input type="number" id="zipcode" name="zipcode" min="100" max="999999" value="<%=profile.zipcode%>" required>
							<br>
					<br>
					<h2>Volunteer preferences</h2>
					<form>
						<label for="skillSelect">Skills</label>
							<label for="addSkill">
								<select id="skillSelect" name="skillSelect" required>
									<!-- Creates the skill select dropdown -->
									<% allSkills.forEach(function(skill) { %>
										<option value="<%=skill.skill_id%>"><%=skill.skill_name%></option>
									<% }) %>
								</select>
							</label>
							<button type="button" id="addSkill" onclick="userprefsAddSkill()">Add Skill</button>
							<br>
							<!-- Where the skills get added -->
							<table id="selectedSkillTable" class="multiselect">
								<tr>
									<th>Skill</th>
									<th>Actions</th>
								</tr>
								<!-- Creates the already chosen skills -->
								<% userSkills.forEach(function(skill) { %>
										<tr id="<%=skill.skill_id%>">
											<td><%=skill.skill_name%></td>
											<td><button type="button" class="fill cancel" onclick="userprefsRemoveSkill('<%=skill.skill_id%>')">Remove</button></td>
										</tr>
								<% }) %>
							</table>
						<label for="preferences">Preferences</label>
							<textarea type="" id="preferences" name="preferences" maxlength="500"><%=profile.preferences%></textarea>
							<br>

						<!-- TODO: Make it so you can add more dates -->
						<label for="availability">Availability</label>
							<input type="date" id="availability" name="availability" maxlength="100" value="<%-userAvailability%>" required>
							<br>
						<input type="submit" value="Update information">
					</form>
				</div>
			</article>
		</div>
		<script>
			document.querySelector("form").addEventListener('formdata', (e) => {
				e.preventDefault();
				const formData = e.formData; 

				const skillTable = document.getElementById("selectedSkillTable").children[0];
				const skills = [];
				for (i = 0; i < skillTable.children.length; i++) {
					const row = skillTable.children[i];
					if (row.id != null && row.id != "") {
						console.log(row.id);
						skills.push(row.id);
					}
				}
				formData.append("skills", skills);
				console.log(skills);
				console.log(formData);
			});
		</script>
	</body>
</html>